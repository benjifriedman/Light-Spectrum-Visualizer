<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <title>Dominant Wavelength Simulator</title>

        <style>
            :root {
                --bg: rgb(0, 0, 0);
                --fg: rgba(255, 255, 255, 0.92);
                --muted: rgba(255, 255, 255, 0.72);
                --card: rgba(0, 0, 0, 0.25);
                --border: rgba(255, 255, 255, 0.18);
                --shadow: 0 18px 55px rgba(0, 0, 0, 0.35);
            }

            /* Full-viewport paint (prevents side bars/pillarbox) */
            html,
            body {
                width: 100vw;
                min-height: 100vh;
                margin: 0;
                background: var(--bg);
            }

            body {
                font-family:
                    ui-sans-serif,
                    system-ui,
                    -apple-system,
                    Segoe UI,
                    Roboto,
                    Helvetica,
                    Arial;
                color: var(--fg);
                display: grid;
                place-items: center;
                overflow: hidden; /* prevents overscroll showing black canvas */
                transition: background-color 120ms linear;
            }

            .wrap {
                width: min(900px, 94vw);
                padding: 24px 18px 18px;
                border-radius: 22px;
                background: var(--card);
                border: 1px solid var(--border);
                box-shadow: var(--shadow);
                backdrop-filter: blur(10px);
                -webkit-backdrop-filter: blur(10px);
            }

            h1 {
                margin: 0 0 10px 0;
                font-size: 18px;
                font-weight: 650;
            }

            .sub {
                margin: 0 0 18px 0;
                color: var(--muted);
                font-size: 13px;
                line-height: 1.35;
            }

            .big {
                display: grid;
                gap: 14px;
                place-items: center;
            }

            .nm {
                font-size: clamp(34px, 6vw, 56px);
                font-weight: 750;
                display: flex;
                gap: 10px;
                align-items: baseline;
                letter-spacing: -0.02em;
                text-shadow: 0 2px 14px rgba(0, 0, 0, 0.35);
            }
            .nm small {
                font-size: 16px;
                font-weight: 650;
                opacity: 0.85;
            }

            .chiprow {
                display: flex;
                gap: 10px;
                flex-wrap: wrap;
                justify-content: center;
                align-items: center;
            }

            .chip {
                padding: 8px 10px;
                border-radius: 999px;
                border: 1px solid var(--border);
                background: rgba(0, 0, 0, 0.18);
                font-size: 12px;
                display: inline-flex;
                gap: 8px;
                align-items: center;
                color: rgba(255, 255, 255, 0.86);
            }

            .swatch {
                width: 14px;
                height: 14px;
                border-radius: 4px;
                border: 1px solid rgba(255, 255, 255, 0.25);
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.25);
            }

            .controls {
                display: flex;
                justify-content: center;
                gap: 10px;
                flex-wrap: wrap;
                margin-top: 4px;
            }

            .toggle {
                user-select: none;
                display: inline-flex;
                align-items: center;
                gap: 8px;
                padding: 8px 10px;
                border-radius: 999px;
                border: 1px solid var(--border);
                background: rgba(0, 0, 0, 0.14);
                font-size: 12px;
                color: rgba(255, 255, 255, 0.84);
            }
            .toggle input {
                width: 16px;
                height: 16px;
                accent-color: rgba(255, 255, 255, 0.92);
            }

            .sliderWrap {
                width: min(720px, 90vw);
                margin: 12px auto 0;
            }

            input[type="range"] {
                width: 100%;
                height: 10px;
                border-radius: 999px;
                appearance: none;
                outline: none;
                background: #000;
                box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.18);
            }

            input[type="range"]::-webkit-slider-thumb {
                appearance: none;
                width: 26px;
                height: 26px;
                border-radius: 999px;
                background: rgba(255, 255, 255, 0.92);
                border: 1px solid rgba(0, 0, 0, 0.25);
                box-shadow: 0 10px 25px rgba(0, 0, 0, 0.35);
                cursor: pointer;
            }

            input[type="range"]::-moz-range-thumb {
                width: 26px;
                height: 26px;
                border-radius: 999px;
                background: rgba(255, 255, 255, 0.92);
                border: 1px solid rgba(0, 0, 0, 0.25);
                cursor: pointer;
            }

            .ticks {
                margin-top: 10px;
                display: flex;
                justify-content: space-between;
                font-size: 12px;
                color: rgba(255, 255, 255, 0.75);
                user-select: none;
            }

            .note {
                margin-top: 14px;
                font-size: 12px;
                color: rgba(255, 255, 255, 0.78);
                padding: 10px 12px;
                border-radius: 14px;
                border: 1px solid rgba(255, 255, 255, 0.16);
                background: rgba(0, 0, 0, 0.16);
                line-height: 1.4;
            }
        </style>
    </head>

    <body>
        <div class="wrap">
            <h1>Approximate dominant wavelength → perceived color</h1>
            <p class="sub">
                The slider spans <strong>UV → visible → IR</strong> (300–900
                nm). By default, UV/IR fade toward black because humans can’t
                see them. Optionally, you can enable a
                <em>false-color</em> preview for UV/IR.
            </p>

            <div class="big">
                <div class="nm">
                    <span id="nmValue">600</span><small>nm</small>
                </div>

                <div class="chiprow">
                    <div class="chip">
                        <span class="swatch" id="swatch"></span
                        ><span id="rgbText">rgb(…)</span>
                    </div>
                    <div class="chip"><span id="hexText">#……</span></div>
                    <div class="chip">
                        <span id="visText">Visible-ish</span>
                    </div>
                </div>

                <div class="controls">
                    <label
                        class="toggle"
                        title="Show artificial colors for UV/IR so they are visually distinct instead of fading to black."
                    >
                        <input id="falseColor" type="checkbox" />
                        False-color UV/IR
                    </label>
                </div>
            </div>

            <div class="sliderWrap">
                <input
                    id="slider"
                    type="range"
                    min="300"
                    max="900"
                    value="600"
                    step="1"
                />
                <div class="ticks">
                    <span>300 (UV)</span>
                    <span>380</span>
                    <span>500</span>
                    <span>600</span>
                    <span>700</span>
                    <span>900 (IR)</span>
                </div>

                <div class="note" id="note"></div>
            </div>
        </div>

        <script>
            // --------------------------
            // Wavelength → RGB (approx)
            // --------------------------
            function wavelengthToRGB(nm) {
                let r = 0,
                    g = 0,
                    b = 0;

                if (nm >= 380 && nm < 440) {
                    r = -(nm - 440) / (440 - 380);
                    b = 1;
                } else if (nm >= 440 && nm < 490) {
                    g = (nm - 440) / (490 - 440);
                    b = 1;
                } else if (nm >= 490 && nm < 510) {
                    g = 1;
                    b = -(nm - 510) / (510 - 490);
                } else if (nm >= 510 && nm < 580) {
                    r = (nm - 510) / (580 - 510);
                    g = 1;
                } else if (nm >= 580 && nm < 645) {
                    r = 1;
                    g = -(nm - 645) / (645 - 580);
                } else if (nm >= 645 && nm <= 780) {
                    r = 1;
                }

                // Intensity fade in/out near the typical visible boundaries:
                let factor = 0;
                if (nm >= 380 && nm < 420)
                    factor = 0.25 + (0.75 * (nm - 380)) / (420 - 380);
                else if (nm >= 420 && nm <= 700) factor = 1;
                else if (nm > 700 && nm <= 780)
                    factor = 0.25 + (0.75 * (780 - nm)) / (780 - 700);
                else factor = 0;

                const gamma = 0.8;
                const toByte = (c) =>
                    c <= 0 ? 0 : Math.round(255 * Math.pow(c * factor, gamma));
                return { r: toByte(r), g: toByte(g), b: toByte(b), factor };
            }

            // Optional false-color mapping for UV (<380) and IR (>780):
            // (This is not physically "the" color—it's just a visual cue.)
            function falseColorRGB(nm) {
                // UV 300–380 → push toward violet/blue
                if (nm < 380) {
                    const t = clamp01((nm - 300) / (380 - 300)); // 0..1
                    // interpolate from deep indigo to near-violet
                    const r = lerp(50, 150, t);
                    const g = lerp(0, 40, t);
                    const b = lerp(140, 255, t);
                    return {
                        r: Math.round(r),
                        g: Math.round(g),
                        b: Math.round(b),
                    };
                }
                // IR 780–900 → push toward deep red / dark ember
                if (nm > 780) {
                    const t = clamp01((nm - 780) / (900 - 780));
                    const r = lerp(120, 255, t);
                    const g = lerp(20, 40, t);
                    const b = lerp(0, 10, t);
                    // also dim a bit as we go deeper into IR so it doesn't look "fully visible"
                    const dim = lerp(0.55, 0.25, t);
                    return {
                        r: Math.round(r * dim),
                        g: Math.round(g * dim),
                        b: Math.round(b * dim),
                    };
                }
                // In visible range, fall back to normal mapping
                const { r, g, b } = wavelengthToRGB(nm);
                return { r, g, b };
            }

            function rgbToHex(r, g, b) {
                const h = (n) => n.toString(16).padStart(2, "0");
                return `#${h(r)}${h(g)}${h(b)}`.toLowerCase();
            }

            function clamp01(x) {
                return Math.max(0, Math.min(1, x));
            }
            function lerp(a, b, t) {
                return a + (b - a) * t;
            }

            // ---------------------------------------
            // Slider gradient that matches mapping
            // ---------------------------------------
            function buildSliderGradient(slider, useFalseColor) {
                const min = Number(slider.min);
                const max = Number(slider.max);
                const steps = 140; // smoothness vs perf

                const stops = [];
                for (let i = 0; i <= steps; i++) {
                    const t = i / steps;
                    const nm = min + t * (max - min);

                    let r, g, b;
                    if (useFalseColor) {
                        ({ r, g, b } = falseColorRGB(nm));
                    } else {
                        ({ r, g, b } = wavelengthToRGB(nm));
                    }

                    stops.push(`rgb(${r},${g},${b}) ${t * 100}%`);
                }
                slider.style.background = `linear-gradient(90deg, ${stops.join(",")})`;
            }

            // ---------------------------------------
            // UI wiring
            // ---------------------------------------
            const slider = document.getElementById("slider");
            const nmValue = document.getElementById("nmValue");
            const rgbText = document.getElementById("rgbText");
            const hexText = document.getElementById("hexText");
            const swatch = document.getElementById("swatch");
            const visText = document.getElementById("visText");
            const note = document.getElementById("note");
            const falseColorToggle = document.getElementById("falseColor");

            function classifyVisibility(nm) {
                // Common rough boundaries:
                // visible-ish: ~380–700, extended visible: ~380–780
                if (nm < 380)
                    return { label: "Ultraviolet (not visible)", which: "uv" };
                if (nm <= 700) return { label: "Visible-ish", which: "vis" };
                if (nm <= 780)
                    return { label: "Deep red edge (very dim)", which: "edge" };
                return { label: "Infrared (not visible)", which: "ir" };
            }

            function update() {
                const nm = Number(slider.value);
                nmValue.textContent = nm;

                const useFalseColor = falseColorToggle.checked;

                let r, g, b;
                if (useFalseColor) {
                    ({ r, g, b } = falseColorRGB(nm));
                } else {
                    ({ r, g, b } = wavelengthToRGB(nm));
                }

                const rgb = `rgb(${r}, ${g}, ${b})`;
                const hex = rgbToHex(r, g, b);

                // Full-viewport background
                document.body.style.backgroundColor = rgb;
                document.documentElement.style.backgroundColor = rgb;

                swatch.style.backgroundColor = rgb;
                rgbText.textContent = rgb;
                hexText.textContent = hex;

                const v = classifyVisibility(nm);
                visText.textContent = v.label;

                if (v.which === "uv") {
                    note.innerHTML = useFalseColor
                        ? "<strong>UV (false-color preview):</strong> humans can’t see this; we’re tinting it for intuition."
                        : "<strong>Ultraviolet:</strong> humans can’t see this, so the display fades toward black.";
                } else if (v.which === "ir") {
                    note.innerHTML = useFalseColor
                        ? "<strong>IR (false-color preview):</strong> humans can’t see this; we’re tinting it for intuition."
                        : "<strong>Infrared:</strong> humans can’t see this, so the display fades toward black.";
                } else if (v.which === "edge") {
                    note.innerHTML =
                        "<strong>Near the red edge:</strong> perception is very dim and display approximations get especially hand-wavy.";
                } else {
                    note.innerHTML =
                        "<strong>Visible spectrum approximation:</strong> single-wavelength (“spectral”) colors rendered on an RGB display.";
                }
            }

            function rebuildGradient() {
                buildSliderGradient(slider, falseColorToggle.checked);
            }

            slider.addEventListener("input", update);
            falseColorToggle.addEventListener("change", () => {
                rebuildGradient();
                update();
            });

            // Optional: arrow keys adjust by 1 nm adjust by 1 nm
            window.addEventListener("keydown", (e) => {
                if (e.key === "ArrowLeft" || e.key === "ArrowDown") {
                    slider.value = String(
                        Math.max(Number(slider.min), Number(slider.value) - 1),
                    );
                    update();
                }
                if (e.key === "ArrowRight" || e.key === "ArrowUp") {
                    slider.value = String(
                        Math.min(Number(slider.max), Number(slider.value) + 1),
                    );
                    update();
                }
            });

            // Init
            rebuildGradient();
            update();
        </script>
    </body>
</html>
